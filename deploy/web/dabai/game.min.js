window.onload=function(){cc.game.onStart=function(){cc.LoaderScene.preload(g_resources,function(){var f=cc.Scene.extend({onEnter:function(){this._super();cc.spriteFrameCache.addSpriteFrames("res/common.plist","res/common.png");startLayer=new b();this.addChild(startLayer);}});var c=cc.Scene.extend({onEnter:function(){this._super();multiLayer=new cc.LayerMultiplex(new a(),new e(),new d());multiLayer.switchTo(0);this.addChild(multiLayer);}});var b=cc.Layer.extend({ctor:function(){this._super();bg=cc.Sprite.create("res/1.png");bg.setPosition(cc.winSize.width/2,cc.winSize.height/2);bg.setAnchorPoint(0.5,0.5);this.addChild(bg);rank=cc.Sprite.create("res/2.png");rank.setAnchorPoint(0.5,0.5);rank.setPosition(-9999,-9999);var g=new cc.LabelTTF("这个是排行榜页面","微软雅黑",20);g.setPosition(rank.getContentSize().width/2,rank.getContentSize().height/2);g.setAnchorPoint(0.5,0.5);rank.addChild(g);this.addChild(rank);rule=cc.Sprite.create("res/3.png");rule.setAnchorPoint(0.5,0.5);rule.setPosition(-9999,-9999);var h=new cc.LabelTTF("这个是规则页面","微软雅黑",20);h.setPosition(rule.getContentSize().width/2,rule.getContentSize().height/2);g.setAnchorPoint(0.5,0.5);rule.addChild(h);this.addChild(rule);},onEnter:function(){this._super();var j=cc.Menu.create();var s=cc.Sprite.create("#kaishiyouxi.png");var r=cc.Sprite.create("#kaishiyouxi.png");var q=cc.Sprite.create("#kaishiyouxi.png");var g=cc.MenuItemSprite.create(s,r,q,function(){cc.director.runScene(new c());},this);g.setScale(0.7,0.7);var k=cc.Sprite.create("#chengjiuban.png");var i=cc.Sprite.create("#chengjiuban.png");var h=cc.Sprite.create("#chengjiuban.png");var m=cc.MenuItemSprite.create(k,i,h,function(){rank.setPosition(cc.winSize.width/2,cc.winSize.height/2);rule.setPosition(-9999,-9999);bg.setPosition(-9999,-9999);},this);m.setScale(0.7,0.7);var p=cc.Sprite.create("#guizeshuoming.png");var o=cc.Sprite.create("#guizeshuoming.png");var n=cc.Sprite.create("#guizeshuoming.png");var l=cc.MenuItemSprite.create(p,o,n,function(){rule.setPosition(cc.winSize.width/2,cc.winSize.height/2);rank.setPosition(-9999,-9999);bg.setPosition(-9999,-9999);},this);l.setScale(0.7,0.7);j.addChild(m);j.addChild(g);j.addChild(l);j.alignItemsHorizontallyWithPadding(50);j.setPosition(cc.winSize.width/2,60);this.addChild(j);}});var a=cc.Layer.extend({ctor:function(){this._super();var g=cc.director.getWinSize();cc.spriteFrameCache.addSpriteFrames("res/xuemo.plist","res/xuemo.png");spriteHero=cc.Sprite.create(cc.spriteFrameCache.getSpriteFrame("#fly_043血魔_01.png"));spriteHero.setPosition(g.width/2,g.height/2);spriteHero.setScale(0.5,0.5);this.addChild(spriteHero,1);timeSprite=new cc.LabelTTF("时间: 30秒","微软雅黑",20);timeSprite.setPosition(60,g.height-50);this.addChild(timeSprite,8);scoreSprite=new cc.LabelTTF("得分: 0","微软雅黑",20);scoreSprite.setPosition(g.width-50,g.height-50);this.addChild(scoreSprite,2);},onEnter:function(){var j=0;multiLayer.setUserData(j);var i=30;var h=false;this._super();var g=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(p,m){var n=m.getCurrentTarget();var o=n.convertToNodeSpace(p.getLocation());var k=n.getContentSize();var l=cc.rect(0,0,k.width,k.height);if(cc.rectContainsPoint(l,o)){j++;scoreSprite.setString("得分: "+j,"微软雅黑",20);multiLayer.setUserData(j);return true;}return false;}});cc.eventManager.addListener(g,spriteHero);this.schedule(function(){if(!h&&i==0){cc.log("时间到");var r=cc.loader.getXMLHttpRequest();r.open("GET","http://localhost:8080/a?id="+18617034884,true);r.onreadystatechange=function(){if(r.readyState==4&&(r.status>=200&&r.status<=207)){var t=r.responseText;cc.log(t);r.open("POST","http://localhost:8080/rank/s");r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");r.onreadystatechange=function(){if(r.readyState==4&&(r.status>=200&&r.status<=207)){var w=r.statusText;var v=r.responseText;cc.log(v);}};var u=Base64.encode(j);r.send("t="+encodeURIComponent(t)+"&appid="+1+"&es="+encodeURIComponent(u)+"&u="+18617034884);}};r.send(null);h=true;cc.eventManager.removeAllListeners();multiLayer.switchTo(1);}else{if(!h&&i>0.4){var p=cc.spriteFrameCache.getSpriteFrame("fly_043血魔_02.jpg");var o=cc.spriteFrameCache.getSpriteFrame("fly_043血魔_04.jpg");var n=cc.spriteFrameCache.getSpriteFrame("fly_043血魔_03.jpg");var m=cc.clone(n);var q=[p,o,n,m];var l=cc.Animation.create(q,0.1);var k=cc.animate(l);var s=cc.moveTo(0,60+cc.random0To1()*300,60+cc.random0To1()*400);spriteHero.runAction(cc.sequence(cc.spawn(k,s),cc.delayTime(20)));i=i-0.5;if(parseInt(i)==i){timeSprite.setString("时间: "+i+"秒","微软雅黑",20);}}}},0.5);}});var e=cc.Layer.extend({ctor:function(){this._super();},onEnter:function(){this._super();var i=multiLayer.getUserData();var l=cc.Sprite.create("#game_over.png");l.setAnchorPoint(0.5,0.5);l.setPosition(cc.winSize.width/2,cc.winSize.height/2);var g=new cc.LabelTTF(i+"分","微软雅黑",60);g.setAnchorPoint(0.5,0.5);g.setColor(cc.color(0,0,0,255));g.setPosition(l.getContentSize().width/2,l.getContentSize().height/2);l.addChild(g);this.addChild(l);var h=cc.Menu.create();var r=cc.Sprite.create("#chongxingkaishi.png");var p=cc.Sprite.create("#chongxingkaishi.png");var n=cc.Sprite.create("#chongxingkaishi.png");var k=cc.MenuItemSprite.create(r,p,n,function(){cc.director.runScene(new c());},this);var q=cc.Sprite.create("#xuanyaoyixia.png");var o=cc.Sprite.create("#xuanyaoyixia.png");var m=cc.Sprite.create("#xuanyaoyixia.png");var j=cc.MenuItemSprite.create(q,o,m,function(){document.title="请叫我手速帝，30秒我得了"+i+"分";multiLayer.switchTo(2);},this);h.addChild(k);h.addChild(j);h.setPosition(cc.winSize.width/2,120);h.alignItemsHorizontallyWithPadding(100);this.addChild(h);}});var d=cc.Layer.extend({ctor:function(){this._super();var g=cc.Sprite.create("#share.png");g.setPosition(cc.winSize.width/2,cc.winSize.height-80);g.setAnchorPoint(0.5,0.5);g.setScale(0.5,0.5);this.addChild(g);},onEnter:function(){this._super();var g=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:true,onTouchBegan:function(j,h){var i=h.getCurrentTarget();multiLayer.switchTo(1);return true;}});cc.eventManager.addListener(g,this);}});cc.director.runScene(new f());},this);};cc.game.run("gameCanvas");};