define(["app"],function(app){var imgUrl="http://img.histarter.com";var fileUrl="http://file.histarter.com";app.directive("uploadImg",function(){return{restrict:'AE',scope:{'fileUrl':'=','success':'@','status':'@'},transclude:true,replace:true,template:"<div></div>",controller:['$scope','$http','$upload',function(scope,http,$upload){if(!scope.status){scope.status="点击上传";}
scope.upload=function(files){if(files&&files.length>0){for(var i=0;i<files.length;i++){var file=files[i];http.post("/attachment/getYunPicInfo",{fileName:file.name}).success(function(res){scope.loading=true;$upload.upload({url:res.responseData.postUrl,fields:{policy:res.responseData.policy,signature:res.responseData.signature},file:file}).progress(function(evt){progressPercentage=parseInt(100.0*evt.loaded/evt.total);scope.status="正在上传:"+ progressPercentage+"%";}).success(function(data,status,headers,config){if(data.code==200){scope.status=scope.success;scope.fileUrl=imgUrl+ data.url;scope.fileName=config.file.name;}else{}
scope.loading=false;});})}}}}],link:function(scope,element,attrs,ctrl,transclude){transclude(scope,function(clone,scope){element.append(clone);});}}});app.directive("uploadMultipleImg",function(){return{restrict:'AE',transclude:true,scope:{},replace:true,template:"<div></div>",controller:['$scope','$http','$upload',function(scope,http,$upload){scope.fileList=[];scope.upload=function(files){scope.status=false;if(files&&files.length>0){for(var i=0;i<files.length;i++){var file=files[i];http.post("/attachment/getYunPicInfo",$.param({fileName:file.name})).success(function(res){$upload.upload({url:res.responseData.postUrl,fields:{policy:res.responseData.policy,signature:res.responseData.signature},file:file}).progress(function(evt){progressPercentage=parseInt(100.0*evt.loaded/evt.total);scope.status="正在上传:"+ progressPercentage+"%";}).success(function(data,status,headers,config){if(data.code==200){scope.status=true;scope.fileList.push(imgUrl+ data.url);}else{scope.status=false;}});})}}}}],link:function(scope,element,attrs,ctrl,transclude){transclude(scope,function(clone,scope){element.append(clone);});}}});app.directive("uploadResumeFile",function(){return{restrict:'AE',scope:{'fileUrl':'=','success':'@','status':'@'},transclude:true,replace:true,template:"<div></div>",controller:['$scope','$http','$upload',function(scope,http,$upload){scope.upload=function(files){if(files&&files.length>0){for(var i=0;i<files.length;i++){var file=files[i];http.post("/attachment/getYunResumeFileInfo",$.param({fileName:file.name})).success(function(res){console.log(res);$upload.upload({url:res.responseData.postUrl,fields:{policy:res.responseData.policy,signature:res.responseData.signature},file:file}).progress(function(evt){progressPercentage=parseInt(100.0*evt.loaded/evt.total);scope.status="正在上传:"+ progressPercentage+"%";}).success(function(data,status,headers,config){if(data.code==200){scope.status=scope.success;scope.fileUrl=fileUrl+ data.url;scope.fileName=config.file.name;}else{}});})}}}}],link:function(scope,element,attrs,ctrl,transclude){transclude(scope,function(clone,scope){element.append(clone);});}}});});