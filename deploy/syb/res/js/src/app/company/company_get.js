define(["app","app/home","app/valid","lib/bootstrap-tags","app/company/company_get_overview","app/company/company_get_follow","app/company/company_get_comment","app/company/company_get_stage"],function(app,home,v){app.controller("company_get",['$scope','$http','$location','$modal','commonService','hiUtils','companyService',function($scope,$http,$location,$modal,commonService,util,companyService){var companyId=$("#pId").val();$('#companyqrCode').qrcode({text:"http://www.histarter.com/wechat/company/"+ companyId,width:167,height:167});$scope.openMessageDialog=commonService.openMessageDialog;var routes={'/overview':{templateurl:'/company/company_overview/'+ companyId},'/follow':{templateurl:'/p/company/company_get_follow'},'/comment':{templateurl:'/p/company/company_get_comment'}}
var defaultRoute=routes['/overview'];$scope.$watch(function(){return $location.path();},function(newPath,oldPath){$scope.selectedRouteName=newPath||"/overview";$scope.selectedRoute=routes[newPath]||defaultRoute;$("html,body").animate({scrollTop:0},100);});companyService.getCompanyFansCount(companyId).success(function(data){if(data.success==true){$scope.fansCount=data.str;};});companyService.getCompanyCommentCount(companyId).success(function(data){if(data.success==true){$scope.commentCount=data.str;};});$scope.openEditCompanyInfo=function(){$http.post("/app/company/get/editInfo/"+ companyId).success(function(data){if(data.success){$scope.companyInfo=data.responseData;$scope.$modalCompanyEditModal=$modal({scope:$scope,contentTemplate:commonService.getTmpl("/company/_company_edit_info_modia"),show:true});}});};$scope.updateCompanyInfo=function($event){util.maskSpinnerInner($($event.target));$http.post("/company/update/"+ companyId,$.param($scope.companyInfo)).success(function(data){if(data.success==true){util.success(data.message);$scope.$modalCompanyEditModal.hide();location.href="/"+ data.responseData.domain;}else{util.error(data.message);};util.unMaskSpinnerInner($($event.target),"保存");});};$scope.openEditCompanyDownloadInfo=function(){$http.post("/app/company/get/downloadInfo/"+ companyId).success(function(data){if(data.success){$scope.companyInfo=data.responseData;$scope.$modalCompanyEditDownloadModal=$modal({scope:$scope,contentTemplate:commonService.getTmpl("/company/_company_edit_download_modia"),show:true});}});};$scope.updateDownloadInfo=function($event){util.maskSpinnerInner($($event.target));$http.post("/company/update/"+ companyId,$.param($scope.companyInfo)).success(function(data){if(data.success==true){util.success(data.message);$scope.$modalCompanyEditDownloadModal.hide();location.href="/"+ data.responseData.domain;}else{util.error(data.message);};util.unMaskSpinnerInner($($event.target),"保存");});};companyService.getCompanyComment(companyId,10).success(function(data){if(data.success==true){$scope.commentList=data.responseData.rows;};});$http.post("/jobs/list/company/"+ companyId).success(function(data){if(data.success==true){$scope.jobsList=data.responseData.rows;};});$scope.delJob=function(jobId){if(confirm("确定要删除吗?删除后不可恢复!")){$http.post("/jobs/del/"+ jobId).success(function(data){if(data.success==true){home.success(data.message)}});};};$http.post("/app/company/find/fans/list/"+ companyId,$.param({rows:100})).success(function(data){if(data.success==true&&data.responseData.records){$scope.fansList=data.responseData.rows;};});$scope.doFollow=function($event){$http.post("/app/company/do/follow/"+ companyId).success(function(data){if(data.success==true){if(data.str=="del"){$scope.isFollow=false;}
if(data.str=="add"){$scope.isFollow=true;}}});};$scope.updateWord=function(){companyService.updateCompany($scope.companyId,$scope.companyInfo).success(function(data){if(data.success==true){$scope.edit.word=false;}});}
$scope.doUpdateWord=function(){$http.post("/company/update/"+ companyId,$.param({word:companyInfo.word})).success(function(){});};$(".btn-publish").click(function(){if(confirm("确定要发布吗?")){var $btn=$(this);var c=$btn.html();home.lbtn($btn);$.ajax({url:"/company/publish/"+ id,type:"POST"}).done(function(data){if(data.success==true){location.href=location.href;}else{}
home.cbtn($btn,c);});}});}]);return{init:function(){}};});