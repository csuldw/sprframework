define(["app","app/home","app/valid"],function(app,home,v){app.controller("people_setting_resume",function(){var size=5;var initDelEvent=function(){$(".btn-del").unbind("click");$(".btn-del").click(function(){var lsDiv=$(this).parent().parent().parent().parent();$(this).parent().parent().remove();if(lsDiv.find(".border-bottom-list").length<size){lsDiv.find(".btn").show();}});};var initEvent=function(){var schoollength=$(".school-list").find(".border-bottom-list").length;var worklength=$(".work-list").find(".border-bottom-list").length;var projectlength=$(".project-list").find(".border-bottom-list").length;if(schoollength==size){$(".btn-add-school").hide();}
if(worklength==size){$(".btn-add-work").hide();}
if(projectlength==size){$(".btn-add-project").hide();}
$(".btn-add-school").click(function(){var schoollength=$(".school-list").find(".border-bottom-list").length;if(schoollength+ 1>size){$(this).hide();}else{$(".school-list").append($("#school-temp").render({}));home.converHtml();initDelEvent();if(schoollength+ 1==size){$(this).hide();}}});$(".btn-add-work").click(function(){var worklength=$(".work-list").find(".border-bottom-list").length;if(worklength+ 1>size){$(this).hide();}else{$(".work-list").append($("#work-temp").render({}));home.converHtml();initDelEvent();if(worklength+ 1==size){$(this).hide();}}});$(".btn-add-project").click(function(){var projectlength=$(".project-list").find(".border-bottom-list").length;if(projectlength+ 1>size){$(this).hide();}else{$(".project-list").append($("#project-temp").render({}));home.converHtml();initDelEvent();if(projectlength+ 1==size){$(this).hide();}}});};var loadOther=function(data){if(data){$(".school-list").append($("#school-temp").render(data.school));$(".project-list").append($("#project-temp").render(data.project));$(".work-list").append($("#work-temp").render(data.work));}else{$(".school-list").append($("#school-temp").render({}));$(".project-list").append($("#project-temp").render({}));$(".work-list").append($("#work-temp").render({}));}};var loadWilling=function(){$.ajax({url:path+"/people/get/myresume",type:"POST"}).done(function(data){if(data.success==true){$("#switch-isshow").bootstrapSwitch();$("#switch-isshow").on({'switchChange.bootstrapSwitch':function(event,state){if(state){$("#resumeIsShow").val("10001");}else{$("#resumeIsShow").val("10002");}}});if(data.responseData){$("#resumeForm").html($("#willing-temp").render(data.responseData));if(data.responseData.isShowResume&&data.responseData.isShowResume==10002){$("#switch-isshow").bootstrapSwitch("state",false);}else{$("#switch-isshow").bootstrapSwitch("state",true);}
loadOther(data.responseData);}else{$("#resumeForm").html($("#willing-temp").render({}));loadOther();}
initEvent();initDelEvent();home.converHtml();}});};loadWilling();$(".btn-save").click(function(){if(v.doValidForm($("#resumeForm"))){var $b=$(this);var c=$b.html();home.lbtn($b);$.ajax({url:path+"/people/updateResume",type:"POST",data:home.generateFormData("#resumeForm")}).done(function(data){if(data.success==true){home.success(data.message);loadWilling();$("html,body").animate({scrollTop:0},100);}else{home.error(data.message);}
home.cbtn($b,c);});}});});return{init:function(){}};});