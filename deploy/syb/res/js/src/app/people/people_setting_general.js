define(["app","app/home","app/valid"],function(app,home,valid){app.controller("people_setting_general",['$scope','$http','$location','promiseLoad','$timeout',function($scope,$http,$location,promiseLoad,timeout){$scope.getTelMin=0;$scope.isGetTelCode=false;$http.post(path+"/people/get/myInfo").success(function(data){if(data.success==true){$scope.userInfo=data.responseData;}});$scope.getTelNote=function(){if(valid.doValidForm($("#modifyGeneralForm"))){$scope.getTelNotePromise=promiseLoad.endless();$http.post(path+"/note/bind/user",$.param({tel:$scope.edit.tel})).success(function(data){if(data.success==true){home.success(data.message);$scope.isGetTelCode=true;$scope.getTelMin=60;var timer=window.setInterval(function(){$scope.$apply(function(){$scope.getTelMin--;});if($scope.getTelMin==0){window.clearInterval(timer);}},1000)
$scope.getTelNotePromise=promiseLoad.success();}else{home.error(data.message);$scope.getTelNotePromise=promiseLoad.error();}});}};$scope.doChangeTel=function(){if(valid.doValidForm($("#modifyGeneralForm"))){$scope.changeTelNotePromise=promiseLoad.endless();$http.post(path+"/people/update/tel",$.param($scope.edit)).success(function(data){if(data.success==true){home.success(data.message);$scope.userInfo.tel=$scope.edit.tel;$scope.getTelMin=0;$scope.isGetTelCode=false;$scope.edit.telcode=undefined;$scope.edit.tel=undefined;$scope.edit.updateTel=false;$scope.changeTelNotePromise=promiseLoad.success();}else{home.error(data.message);$scope.changeTelNotePromise=promiseLoad.error();}});}};$scope.updateUser=function(){if(valid.doValidForm($("#modifyGeneralForm"))){$scope.updateUserPromise=promiseLoad.endless();$http.post(path+"/people/updateInfo",$.param($scope.userInfo)).success(function(data){if(data.success==true){home.success(data.message);$scope.updateUserPromise=promiseLoad.success();}else{home.error(data.message);$scope.updateUserPromise=promiseLoad.error();}});}}}])
return{init:function(){}};});